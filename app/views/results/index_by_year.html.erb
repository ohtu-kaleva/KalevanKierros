<h3>Vuoden <%= params[:year] %> tulokset</h3>
<div>
  <select id="selector1" style="width: initial; max-width: initial;" class="form-control input-sm <% unless params[:type].eql?("all") %>selected<% end %>">
    <option value="all" <% if params[:type] == "all" then %> selected <% end %>>Kaikki lajit</option>
    <option value="skating" <% if params[:type] == "skating" then %> selected <% end %>>Luistelu</option>
    <option value="skiing" <% if params[:type] == "skiing" then %> selected <% end %>>Hiihto</option>
    <option value="orienteering" <% if params[:type] == "orienteering" then %> selected <% end %>>Suunnistus</option>
    <option value="rowing" <% if params[:type] == "rowing" then %> selected <% end %>>Soutu</option>
    <option value="cycling" <% if params[:type] == "cycling" then %> selected <% end %>>Pyöräily</option>
    <option value="marathon" <% if params[:type] == "marathon" then %> selected <% end %>>Juoksu</option>
  </select>
  <select id="selector2" style="width: initial; max-width: initial;" class="form-control input-sm <% unless params[:gender].eql?("all") %>selected<% end %>">
    <option value="all" <% if params[:gender] == "all" then %> selected <% end %>>Miehet ja naiset</option>
    <option value="M" <% if params[:gender] == "M" then %> selected <% end %>>Miehet</option>
    <option value="N" <% if params[:gender] == "N" then %> selected <% end %>>Naiset</option>
  </select>
  <select id="selector3" style="width: initial; max-width: initial;" class="form-control input-sm <% unless params[:age_group].eql?("all") %>selected<% end %>">
    <option value="all">Kaikki ikäsarjat</option>
    <% @res[:series].each do |s| %>
        <% if s == params[:age_group] %>
            <option value="<%=s%>" selected><%=s%> ikäsarja</option>
        <% else %>
            <option value="<%=s%>"><%=s%> ikäsarja</option>
        <% end %>
    <% end %>
  </select>
  <style type="text/css">select.selected{box-shadow: 0 1px 10px red;}select.form-control{max-width: 100px; display: inline;}</style>
  <script type="text/javascript">
      $( "#selector1" ).change(function() {
          var url = '/results/year/<%= params[:year]%>/<%= params[:gender]%>/<%= params[:age_group]%>/' + $(this).val();
          if (url) { // require a URL
              window.location = url; // redirect
          }
          return false;
      });
      $( "#selector2" ).change(function() {
          var url = '/results/year/<%= params[:year]%>/' + $(this).val() + '/<%= params[:age_group]%>/<%= params[:type]%>';
          if (url) { // require a URL
              window.location = url; // redirect
          }
          return false;
      });
      $( "#selector3" ).change(function() {
          var url = '/results/year/<%= params[:year]%>/<%= params[:gender]%>/' + $(this).val() + '/<%= params[:type]%>';
          if (url) { // require a URL
              window.location = url; // redirect
          }
          return false;
      });
  </script>
</div>

<% if params[:type] == "all" then %>
  <div style="padding: 14px 0; font-size: 14px;">Klikkaamalla kilpailijan nimeä näet tarkemmat suoritustiedot.</div>

<table class="results">
  <tr style="height: 30px; ">
    <td width="30%">Nimi</td>
    <td width="40%">Joukkue</td>
    <td width="10%">Sarja</td>
    <td width="10%">Lajit</td>
    <td colspan="3" width="10%">Pisteet</td>
    <% if user_is_admin? %>
    <td width="10%">Muokkaa</td>
    <% end %>
  </tr>

  <% i = 0
     @res[:results].each do |result| %>
      <% i += 1 %>
      <tr>
        <td width="30%"><%= i %>. <a href="#" onclick="event.preventDefault(); $('#stat<%= i %>').toggle()"><%= result.name %></a></td>
        <td width="40%"><%= result.group %></td>
        <td width="10%"><%= result.series %></td>
        <td width="10%"><%= result.completed_events %></td>
        <td colspan="3" width="10%"><% unless result.pts_sum.nil? then %><%= result.pts_sum.round(2) %> <% end %></td>
        <% if user_is_admin? %>
        <td width="10%"><%= link_to 'Muokkaa', edit_result_path(result) %></td>
        <% end %>
      </tr>
      <tr><td colspan="5">
        <table style="display: none; margin-top: 20px;" class="results child" id="stat<%= i %>">
            <tr style="border-bottom: 1px solid black;">
              <td width="5%"></td>
              <td width="25%">Laji</td>
              <td width="30%">Tyyli</td>
              <td width="10%">Sijoitus</td>
              <td width="20%">Aika</td>
              <td width="10%">Pisteet</td>
            </tr>
          <tr>
              <td></td>
              <td>Luistelu</td>
              <td></td>
              <td><%= result.skating_pos %></td>
              <td><%= seconds_to_human_form(result.skating_time) %></td>
              <td><% unless result.skating_pts.nil? then %><%=result.skating_pts.round(2) %> <% end %></td>
          </tr>
          <tr>
              <td></td>
              <td>Hiihto</td>
              <td><%= result.skiing_style %></td>
              <td><%= result.skiing_pos %></td>
              <td><%= seconds_to_human_form(result.skiing_time) %></td>
              <td><% unless result.skiing_pts.nil? then %><%=result.skiing_pts.round(2) %> <% end %></td>
          </tr>
          <tr>
            <td></td>
            <td>Maraton</td>
            <td><%= result.marathon_style %></td>
            <td><%= result.marathon_pos %></td>
            <td><%= seconds_to_human_form(result.marathon_time) %></td>
            <td><% unless result.marathon_pts.nil? then %><%=result.marathon_pts.round(2) %> <% end %></td>
          </tr>
          <tr>
              <td></td>
              <td>Soutu</td>
              <td><%= result.rowing_style %></td>
              <td><%= result.rowing_pos %></td>
              <td><%= seconds_to_human_form(result.rowing_time) %></td>
              <td><% unless result.rowing_pts.nil? then %><%=result.rowing_pts.round(2) %> <% end %></td>
          </tr>
          <tr>
              <td></td>
              <td>Pyöräily</td>
              <td></td>
              <td><%= result.cycling_pos %></td>
              <td><%= seconds_to_human_form(result.cycling_time) %></td>
              <td><% unless result.cycling_pts.nil? then %><%=result.cycling_pts.round(2) %> <% end %></td>
          </tr>
          <tr>
              <td width="5%"></td>
              <td width="25%">Suunnistus</td>
              <td width="30%"></td>
              <td width="10%"><%= result.orienteering_pos %></td>
              <td width="20%"><%= seconds_to_human_form(result.orienteering_time) %></td>
              <td width="10%"><% unless result.orienteering_pts.nil? then %><%=result.orienteering_pts.round(2) %> <% end %></td>
          </tr>
        </table>
      </td></tr>
  <% end %>
</table>
<style type="text/css">
  table.results {
      width:100%;max-width:100%;margin-bottom:20px
  }
        table.child{
            margin-top: 5px; margin-bottom: 20px; float: right;
        }
</style>

<% else %>
    <table class="results" width="80%">
      <tr style="height: 50px; vertical-align: top;">
        <td width="20%">Sijoitus / Kilpailija</td>
        <td width="60%"></td>
        <td width="10%">Loppuaika</td>
        <td colspan="3" width="10%">Lajipisteet</td>
      </tr>

      <% i = 0
         @res[:results].each do |result| %>
          <% i += 1 %>
          <tr>
            <td width="20%"><%= i %>. <%= result[0] %></td>
            <td width="60%"></td>
            <td width="10%"><%= seconds_to_human_form(result[3]) %></td>
            <td colspan="3" width="10%"><%= result[2].round(2) %></td>
          </tr>

      <% end %>
    </table>
    <style type="text/css">
        table.results {
            width:100%;max-width:100%;margin-bottom:20px
        }
        table.child{
            margin-top: 5px; margin-bottom: 20px; float: right;
        }
    </style>
<% end %>

<br>
<%= link_to 'Joukkuetulokset', results_by_year_and_groups_path(params[:year]), class: "btn btn-primary" %>&nbsp;
    <% if user_is_admin? %>
<%= link_to 'Syötä uusi tulos', new_result_path, class: "btn btn-default" %>
<%= link_to 'Päivitä tilastot', update_statistics_path(params[:year]), data: { confirm: "Päivitetäänkö tilastot?" }, method: :post, class: "btn btn-default" %>
<% end %>