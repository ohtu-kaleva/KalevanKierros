<div class="col-lg-12">
  <h1>Kierrosilmoittautumiset</h1>
<p>Kierrokselle ilmoittautuneiden lista. Tällä sivulla voit päivittää henkilön maksutilanteen. Jos henkilö on joukkueen kapteeni, myös muiden joukkueen jäsenten maksutilanne päivitetään.</p>
<%= form_tag('/kk_enrollments', method: :put) do %>
<table id="kk_enrollments" class="table table-striped tablesorter-bootstrap">
  <thead>
    <tr>
      <th>Etunimi</th>
      <th>Sukunimi</th>
      <th>Joukkue</th>
      <th>Viitenumero</th>
      <th>Maksettava</th>
      <th>Maksettu</th>
    </tr>
  </thead>

  <tbody>
    <% @kk_enrollments.each do |enrollment| %>
      <tr>
        <td><%= enrollment.user.first_name %></td>
        <td><%= enrollment.user.last_name %></td>
        <% if enrollment.user.group.nil? %>
            <td>Ei joukkuetta</td>
        <% else %>
            <td><%= enrollment.user.group.name %></td>
        <% end %>
        <% if not enrollment.user.group.nil? and enrollment.user == enrollment.user.group.user %>
            <td><%= enrollment.user.construct_reference_number %></td>
            <td>200</td>
        <% elsif enrollment.user.group.nil? %>
            <td><%= enrollment.user.construct_reference_number %></td>
            <td>50</td>
        <% else %>
            <td></td>
            <td></td>
        <% end %>
        <td ><div class="form-group">
          <% if enrollment.paid.nil? %>
            <%= text_field_tag "paid[#{enrollment.id}]", nil, maxlength: 8, :class => "form-control min-width" %>
          <% else %>
            <%= text_field_tag "paid[#{enrollment.id}]", enrollment.paid/100.0, :class => "form-control min-width"  %>
          <% end %>
          </div></td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= submit_tag 'Päivitä maksutiedot', :class => "btn btn-primary" %><br>
<% end %>
<br>
<%= link_to 'Takaisin', admin_kk_enrollment_path, class: 'btn btn-primary' %>
</div>

<script type="text/javascript">
    $(document).ready(function () {
                $.extend($.tablesorter.themes.bootstrap, {
                    // these classes are added to the table. To see other table classes available,
                    // look here: http://twitter.github.com/bootstrap/base-css.html#tables
                    table      : 'table table-bordered',
                    caption    : 'caption',
                    header     : 'bootstrap-header', // give the header a gradient background
                    footerRow  : '',
                    footerCells: '',
                    icons      : '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
                    sortNone   : 'bootstrap-icon-unsorted',
                    sortAsc    : 'icon-chevron-up glyphicon glyphicon-chevron-up',     // includes classes for Bootstrap v2 & v3
                    sortDesc   : 'icon-chevron-down glyphicon glyphicon-chevron-down', // includes classes for Bootstrap v2 & v3
                    active     : '', // applied when column is sorted
                    hover      : '', // use custom css here - bootstrap class may not override it
                    filterRow  : '', // filter row class
                    even       : '', // odd row zebra striping
                    odd        : ''  // even row zebra striping
                });
                $("#kk_enrollments").tablesorter({
//                    headers: {4: {sorter:false, filter:false} },
                    theme : "bootstrap",
                    headerTemplate : '{content} {icon}',
                    widgets : [ "uitheme", "filter" ],
                })
            }
    );
</script>